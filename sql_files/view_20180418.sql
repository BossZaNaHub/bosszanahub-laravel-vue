CREATE OR REPLACE VIEW `kpi_attendance_view` AS select `staff`.`id_staff` AS `id`,`kpi_attendance`.`atten_id` AS `atten_id`,`staff`.`title_th` AS `title`,`staff`.`fname_th` AS `name`,`staff`.`lname_th` AS `last`,`staff`.`nick_th` AS `nick`,`staff`.`dept` AS `dept`,`staff`.`posit` AS `posit`,`staff`.`email` AS `email`,`kpi_attendance`.`late` AS `late`,`kpi_attendance`.`total` AS `total`,`kpi_attendance`.`create_date_current` AS `date`,`kpi_role`.`role` AS `privilege`,`kpi_role`.`week` AS `week` from ((`staff` join `kpi_attendance` on((`staff`.`id_staff` = `kpi_attendance`.`id_staff`))) join `kpi_role` on((`staff`.`id_staff` = `kpi_role`.`id_staff`))) where (`kpi_role`.`attendance` = 'T');

CREATE OR REPLACE VIEW `kpi_role_view` AS select `staff`.`id_staff` AS `staff`,`staff`.`title_th` AS `title`,`staff`.`fname_th` AS `name`,`staff`.`lname_th` AS `last`,`staff`.`nick_th` AS `nick`,`staff`.`fname_en` AS `nameen`,`staff`.`pic` AS `pic`,`staff`.`dept` AS `dept`,`staff`.`posit` AS `posit`,`staff`.`email` AS `email`,`staff`.`privilege` AS `privilege`,`staff`.`supervisor` AS `super`,`kpi_role`.`personal` AS `role_personal`,`kpi_role`.`week` AS `role_week`,`kpi_role`.`attendance` AS `role_attendance`,`kpi_privilege`.`privilege_name` AS `role_name`,`kpi_role`.`role` AS `role_id` from ((`staff` join `kpi_role` on((`staff`.`id_staff` = `kpi_role`.`id_staff`))) join `kpi_privilege` on((`kpi_privilege`.`id` = `kpi_role`.`role`)));

CREATE OR REPLACE VIEW `kpi_view_performance` AS select `staff`.`id_staff` AS `staff`,`staff`.`fname_th` AS `name`,`staff`.`lname_th` AS `last`,`staff`.`nick_th` AS `nick`,`staff`.`posit` AS `posit`,`staff`.`dept` AS `dept`,`staff`.`supervisor` AS `super`,`kpi_performance`.`performance_point` AS `perf_point`,`kpi_performance`.`create_date_current` AS `perf_date`,`kpi_performance_details`.`qmr_status` AS `status` from ((`staff` join `kpi_performance` on((`staff`.`id_staff` = `kpi_performance`.`id_staff`))) join `kpi_performance_details` on((`kpi_performance_details`.`perf_point_id` = `kpi_performance`.`perf_id`)));

CREATE OR REPLACE VIEW `kpi_view_performance_image` AS select `kpi_performance_details`.`id_staff` AS `id`,`kpi_performance_type`.`type_name` AS `type`,`kpi_performance_details`.`create_date` AS `date`,`kpi_stock_image`.`image_gen_id` AS `file_gen_id`,`kpi_stock_image`.`image_stock_file` AS `file`,`kpi_stock_image`.`image_stock_id` AS `file_id`,`kpi_stock_image`.`image_stock_path` AS `file_path` from ((`kpi_stock_image` join `kpi_performance_details` on((`kpi_performance_details`.`image_stock_id` = `kpi_stock_image`.`image_gen_id`))) join `kpi_performance_type` on((`kpi_performance_type`.`id` = `kpi_performance_details`.`performance_topic_type`))) group by `kpi_stock_image`.`image_stock_id`;

CREATE OR REPLACE VIEW `kpi_view_performance_suit` AS select `kpi_performance_details`.`id_staff` AS `id`,`kpi_performance_details`.`perf_detail_id` AS `perf_detail_id`,`kpi_performance_details`.`qmr_ref_id` AS `qmr_ref_id`,`kpi_performance_details`.`qmr_status` AS `qmr_status`,`kpi_performance_details`.`qmr_id` AS `qmr_id`,`kpi_performance_details`.`perf_topic` AS `topic`,`kpi_performance_details`.`perf_max_point` AS `max`,`kpi_performance_details`.`perf_point` AS `point`,`kpi_performance_details`.`perf_ps` AS `ps`,`kpi_performance_details`.`image_stock_id` AS `image_id`,`kpi_performance_details`.`create_date` AS `date`,`kpi_performance`.`perf_id` AS `perf_id`,`kpi_performance`.`performance_point` AS `getpoint`,`kpi_performance_type`.`type_name` AS `type_topic` from ((`kpi_performance_details` join `kpi_performance` on((`kpi_performance_details`.`perf_point_id` = `kpi_performance`.`perf_id`))) join `kpi_performance_type` on((`kpi_performance_details`.`performance_topic_type` = `kpi_performance_type`.`id`)));

CREATE OR REPLACE VIEW `kpi_view_point` AS select `staff`.`id_staff` AS `staff`,`kpi_performance`.`performance_point` AS `perf_point`,`kpi_week`.`total` AS `week_point`,`kpi_attendance`.`total` AS `time_point`,`staff`.`posit` AS `posit`,`staff`.`dept` AS `dept`,`staff`.`status` AS `status`,`staff`.`supervisor` AS `supervisor`,`kpi_performance`.`create_date_current` AS `date` from (((`staff` join `kpi_performance` on((`staff`.`id_staff` = `kpi_performance`.`id_staff`))) join `kpi_week` on((`kpi_week`.`id_staff` = `staff`.`id_staff`))) join `kpi_attendance` on((`kpi_attendance`.`id_staff` = `staff`.`id_staff`)));

CREATE OR REPLACE VIEW `kpi_view_result` AS select `staff`.`id_staff` AS `id_staff`,concat(`staff`.`title_th`,' ',`staff`.`fname_th`,' ',`staff`.`lname_th`,' (',`staff`.`nick_th`,')') AS `fullname`,`staff`.`dept` AS `dept`,`staff`.`email` AS `email`,`kpi_performance`.`performance_point` AS `A`,`kpi_week`.`total` AS `P`,`kpi_attendance`.`total` AS `K`,((`kpi_performance`.`performance_point` + `kpi_week`.`total`) + `kpi_attendance`.`total`) AS `total`,(case when (((`kpi_performance`.`performance_point` + `kpi_week`.`total`) + `kpi_attendance`.`total`) > 90) then 'A' when ((((`kpi_performance`.`performance_point` + `kpi_week`.`total`) + `kpi_attendance`.`total`) >= 86) and (((`kpi_performance`.`performance_point` + `kpi_week`.`total`) + `kpi_attendance`.`total`) <= 90)) then 'B+' when ((((`kpi_performance`.`performance_point` + `kpi_week`.`total`) + `kpi_attendance`.`total`) >= 81) and (((`kpi_performance`.`performance_point` + `kpi_week`.`total`) + `kpi_attendance`.`total`) <= 85)) then 'B' when ((((`kpi_performance`.`performance_point` + `kpi_week`.`total`) + `kpi_attendance`.`total`) >= 71) and (((`kpi_performance`.`performance_point` + `kpi_week`.`total`) + `kpi_attendance`.`total`) <= 80)) then 'C+' when ((((`kpi_performance`.`performance_point` + `kpi_week`.`total`) + `kpi_attendance`.`total`) >= 61) and (((`kpi_performance`.`performance_point` + `kpi_week`.`total`) + `kpi_attendance`.`total`) <= 70)) then 'C' when ((((`kpi_performance`.`performance_point` + `kpi_week`.`total`) + `kpi_attendance`.`total`) >= 56) and (((`kpi_performance`.`performance_point` + `kpi_week`.`total`) + `kpi_attendance`.`total`) <= 60)) then 'D+' when ((((`kpi_performance`.`performance_point` + `kpi_week`.`total`) + `kpi_attendance`.`total`) >= 50) and (((`kpi_performance`.`performance_point` + `kpi_week`.`total`) + `kpi_attendance`.`total`) <= 55)) then 'D' else 'F' end) AS `Grade`,`kpi_role`.`personal` AS `personal`,`kpi_role`.`week` AS `week`,`kpi_role`.`attendance` AS `attendance`,`staff`.`privilege` AS `privilege`,`staff`.`supervisor` AS `supervisor`,`kpi_performance`.`create_date_current` AS `perf_date`,`kpi_week`.`create_date_current` AS `week_date` from ((((`staff` join `kpi_performance` on((`staff`.`id_staff` = `kpi_performance`.`id_staff`))) join `kpi_week` on(((`kpi_performance`.`id_staff` = `kpi_week`.`id_staff`) and (date_format(`kpi_performance`.`create_date_current`,'%Y-%m') = date_format(`kpi_week`.`create_date_current`,'%Y-%m'))))) join `kpi_attendance` on(((`kpi_performance`.`id_staff` = `kpi_attendance`.`id_staff`) and (date_format(`kpi_performance`.`create_date_current`,'%Y-%m') = date_format(`kpi_attendance`.`create_date_current`,'%Y-%m'))))) join `kpi_role` on((`kpi_role`.`id_staff` = `staff`.`id_staff`))) where ((`staff`.`status` = 'Employee') and (`staff`.`kpi` <> 'no')) union select `staff`.`id_staff` AS `id_staff`,concat(`staff`.`title_th`,' ',`staff`.`fname_th`,' ',`staff`.`lname_th`,' (',`staff`.`nick_th`,')') AS `fullname`,`staff`.`dept` AS `dept`,`staff`.`email` AS `email`,`kpi_performance`.`performance_point` AS `A`,`kpi_week`.`total` AS `P`,'-' AS `K`,round(((100 * (`kpi_performance`.`performance_point` + `kpi_week`.`total`)) / 90),2) AS `total`,(case when (round(((100 * (`kpi_performance`.`performance_point` + `kpi_week`.`total`)) / 90),2) > 90) then 'A' when ((round(((100 * (`kpi_performance`.`performance_point` + `kpi_week`.`total`)) / 90),2) >= 86) and (round(((100 * (`kpi_performance`.`performance_point` + `kpi_week`.`total`)) / 90),2) <= 90)) then 'B+' when ((round(((100 * (`kpi_performance`.`performance_point` + `kpi_week`.`total`)) / 90),2) >= 81) and (round(((100 * (`kpi_performance`.`performance_point` + `kpi_week`.`total`)) / 90),2) <= 85)) then 'B' when ((round(((100 * (`kpi_performance`.`performance_point` + `kpi_week`.`total`)) / 90),2) >= 71) and (round(((100 * (`kpi_performance`.`performance_point` + `kpi_week`.`total`)) / 90),2) <= 80)) then 'C+' when ((round(((100 * (`kpi_performance`.`performance_point` + `kpi_week`.`total`)) / 90),2) >= 61) and (round(((100 * (`kpi_performance`.`performance_point` + `kpi_week`.`total`)) / 90),2) <= 70)) then 'C' when ((round(((100 * (`kpi_performance`.`performance_point` + `kpi_week`.`total`)) / 90),2) >= 56) and (round(((100 * (`kpi_performance`.`performance_point` + `kpi_week`.`total`)) / 90),2) <= 60)) then 'D+' when ((round(((100 * (`kpi_performance`.`performance_point` + `kpi_week`.`total`)) / 90),2) >= 50) and (round(((100 * (`kpi_performance`.`performance_point` + `kpi_week`.`total`)) / 90),2) <= 55)) then 'D' else 'F' end) AS `Grade`,`kpi_role`.`personal` AS `personal`,`kpi_role`.`week` AS `week`,`kpi_role`.`attendance` AS `attendance`,`staff`.`privilege` AS `privilege`,`staff`.`supervisor` AS `supervisor`,`kpi_performance`.`create_date_current` AS `create_date_current`,`kpi_week`.`create_date_current` AS `week_date` from (((`staff` join `kpi_performance` on((`staff`.`id_staff` = `kpi_performance`.`id_staff`))) join `kpi_week` on(((`kpi_performance`.`id_staff` = `kpi_week`.`id_staff`) and (date_format(`kpi_performance`.`create_date_current`,'%Y-%m') = date_format(`kpi_week`.`create_date_current`,'%Y-%m'))))) join `kpi_role` on((`kpi_role`.`id_staff` = `staff`.`id_staff`))) where ((`staff`.`status` = 'Employee') and (`staff`.`kpi` <> 'no') and (`staff`.`privilege` = 'supervisor') and isnull(`kpi_role`.`attendance`));

CREATE OR REPLACE VIEW `kpi_week_view` AS select `staff`.`id_staff` AS `id`,`kpi_week`.`week_id` AS `week_id`,`staff`.`title_th` AS `title`,`staff`.`fname_th` AS `name`,`staff`.`lname_th` AS `last`,`staff`.`nick_th` AS `nick`,`staff`.`dept` AS `dept`,`staff`.`posit` AS `posit`,`staff`.`email` AS `email`,`kpi_week`.`week1` AS `w1`,`kpi_week`.`week2` AS `w2`,`kpi_week`.`week3` AS `w3`,`kpi_week`.`week4` AS `w4`,`kpi_week`.`total` AS `total`,`kpi_week`.`create_date_current` AS `date`,`kpi_role`.`role` AS `privilege`,`kpi_role`.`week` AS `week` from ((`staff` join `kpi_week` on((`staff`.`id_staff` = `kpi_week`.`id_staff`))) join `kpi_role` on((`staff`.`id_staff` = `kpi_role`.`id_staff`))) where (`kpi_role`.`week` = 'T');